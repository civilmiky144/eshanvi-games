<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>üåâ Eshanvi's Math World</title>
<link href="https://fonts.googleapis.com/css2?family=Bubblegum+Sans&family=Nunito:wght@500;700;900&display=swap" rel="stylesheet">
<style>
:root{--pink:#ec4899;--purple:#8b5cf6;--orange:#f97316;--yellow:#fbbf24;--green:#22c55e;--blue:#38bdf8;--red:#ef4444;}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;user-select:none;-webkit-user-select:none;}
body{font-family:'Nunito',sans-serif;background:linear-gradient(160deg,#fff9f0,#fef0fb);min-height:100vh;overflow-x:hidden;}

header{background:linear-gradient(90deg,#f97316,#ec4899);padding:12px 18px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 4px 18px rgba(249,115,22,.45);position:relative;z-index:50;}
.home-btn{background:rgba(255,255,255,.22);color:white;border:2px solid rgba(255,255,255,.5);border-radius:50px;padding:7px 14px;font-family:'Nunito',sans-serif;font-weight:900;font-size:.88rem;cursor:pointer;text-decoration:none;display:inline-block;}
header h1{font-family:'Bubblegum Sans',cursive;font-size:clamp(1.1rem,4vw,1.9rem);color:white;text-shadow:2px 2px 0 rgba(0,0,0,.15);flex:1;text-align:center;letter-spacing:1px;}
.hsp{width:70px;}

.score-bar{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;padding:8px 12px 4px;position:relative;z-index:10;}
.chip{background:white;border-radius:50px;padding:6px 14px;font-weight:900;font-size:.88rem;color:#c2410c;box-shadow:0 3px 10px rgba(249,115,22,.18);border:2px solid #fed7aa;transition:transform .15s;}
.chip.pop{animation:chipPop .3s ease;}
@keyframes chipPop{0%,100%{transform:scale(1)}50%{transform:scale(1.3)}}

.mode-tabs{display:flex;gap:10px;justify-content:center;padding:6px 12px 8px;}
.mode-tab{flex:1;max-width:180px;background:white;border:3px solid #fdba74;border-radius:16px;padding:8px 10px;cursor:pointer;text-align:center;font-family:'Bubblegum Sans',cursive;font-size:.95rem;color:#92400e;transition:all .2s;box-shadow:0 3px 10px rgba(0,0,0,.07);}
.mode-tab .ti{font-size:1.6rem;display:block;margin-bottom:2px;}
.mode-tab.active{background:linear-gradient(135deg,#fed7aa,#fbbf24);border-color:#f59e0b;transform:scale(1.04);box-shadow:0 5px 16px rgba(245,158,11,.35);}

/* ‚ïê‚ïê‚ïê VALLEY BRIDGE SCENE ‚ïê‚ïê‚ïê */
#modeA{display:none;}
.scene-wrap{position:relative;z-index:10;margin:0 10px 8px;border-radius:20px;overflow:hidden;border:3px solid #7dd3fc;box-shadow:0 6px 22px rgba(0,0,0,.12);}
#sceneSVG{width:100%;display:block;}

.q-card{position:relative;z-index:10;margin:0 12px 8px;background:white;border-radius:16px;padding:10px 16px;text-align:center;border:3px solid #fbbf24;box-shadow:0 4px 12px rgba(0,0,0,.08);}
.q-label{font-size:.78rem;font-weight:900;color:#92400e;margin-bottom:3px;}
.q-equation{font-family:'Bubblegum Sans',cursive;font-size:clamp(1.5rem,5.5vw,2.2rem);color:#1e3a8a;letter-spacing:2px;}
.q-hint{font-size:.75rem;color:#9ca3af;font-weight:700;margin-top:2px;}

.numpad-wrap{position:relative;z-index:10;margin:0 12px 8px;background:white;border-radius:16px;padding:12px;border:3px solid #bfdbfe;box-shadow:0 4px 12px rgba(0,0,0,.07);}
.answer-display{background:#f0f9ff;border-radius:10px;padding:8px;text-align:center;font-family:'Bubblegum Sans',cursive;font-size:1.9rem;color:#0284c7;letter-spacing:4px;margin-bottom:8px;min-height:48px;border:2px solid #bae6fd;}
.numpad{display:grid;grid-template-columns:repeat(4,1fr);gap:7px;}
.nkey{background:linear-gradient(135deg,#dbeafe,#bfdbfe);border:2.5px solid #60a5fa;border-radius:12px;padding:11px 4px;font-family:'Bubblegum Sans',cursive;font-size:1.25rem;color:#1e3a8a;cursor:pointer;text-align:center;transition:all .12s;}
.nkey:active{transform:scale(.88);background:linear-gradient(135deg,#60a5fa,#3b82f6);color:white;}
.nkey.del{background:linear-gradient(135deg,#fecaca,#fca5a5);border-color:#f87171;color:#7f1d1d;}
.nkey.ok{background:linear-gradient(135deg,#bbf7d0,#6ee7b7);border-color:#22c55e;color:#14532d;grid-column:span 2;}
.bridge-lives{display:flex;gap:4px;justify-content:center;font-size:1.35rem;margin-top:8px;}

/* ‚ïê‚ïê‚ïê CANDY SHOP ‚ïê‚ïê‚ïê */
#modeB{display:none;}
.shop-wrap{position:relative;z-index:10;margin:0 10px 8px;border-radius:20px;overflow:hidden;border:3px solid #fde68a;box-shadow:0 6px 22px rgba(0,0,0,.1);}
#shopSVG{width:100%;display:block;}

.op-selector{display:flex;gap:7px;justify-content:center;padding:0 10px 8px;flex-wrap:wrap;}
.op-btn{background:white;border:2.5px solid #fdba74;border-radius:50px;padding:6px 16px;font-family:'Bubblegum Sans',cursive;font-size:.9rem;color:#92400e;cursor:pointer;transition:all .2s;}
.op-btn.active{background:linear-gradient(135deg,#fbbf24,#f97316);color:white;border-color:transparent;box-shadow:0 4px 10px rgba(249,115,22,.38);}

.combo-row{display:flex;align-items:center;justify-content:center;gap:6px;padding:0 12px 6px;}
.c-dot{width:13px;height:13px;border-radius:50%;background:#e5e7eb;transition:all .25s;}
.c-dot.lit{background:linear-gradient(135deg,#fbbf24,#f97316);transform:scale(1.2);box-shadow:0 2px 6px rgba(251,191,36,.5);}

.problem-card{position:relative;z-index:10;margin:0 12px 8px;background:white;border-radius:16px;padding:12px 16px;border:3px solid #fde68a;box-shadow:0 4px 12px rgba(0,0,0,.07);}
.prob-visual{display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap;margin-bottom:10px;min-height:60px;}
.cg{display:flex;flex-direction:column;align-items:center;gap:3px;}
.ce{font-size:clamp(1.3rem,4.5vw,1.9rem);line-height:1.3;text-align:center;}
.cp{font-family:'Bubblegum Sans',cursive;font-size:.92rem;color:#f97316;background:#fff7ed;border-radius:50px;padding:2px 9px;border:2px solid #fed7aa;}
.op-sym{font-family:'Bubblegum Sans',cursive;font-size:2rem;color:#7c3aed;}
.eq-sym{font-family:'Bubblegum Sans',cursive;font-size:1.8rem;color:#6b7280;}

.choices{display:grid;grid-template-columns:repeat(2,1fr);gap:9px;}
.choice{background:white;border:3px solid #fde68a;border-radius:14px;padding:14px 8px;font-family:'Bubblegum Sans',cursive;font-size:1.5rem;color:#92400e;cursor:pointer;text-align:center;transition:all .18s;box-shadow:0 3px 8px rgba(0,0,0,.06);}
.choice:active{transform:scale(.93);}
.choice.correct{background:#dcfce7;border-color:#22c55e;animation:cBounce .5s ease;}
.choice.wrong{background:#fee2e2;border-color:#ef4444;animation:cShake .4s ease;}
.choice.reveal{background:#dcfce7;border-color:#22c55e;}
@keyframes cBounce{0%,100%{transform:scale(1)}40%{transform:scale(1.12)}}
@keyframes cShake{0%,100%{transform:translateX(0)}25%{transform:translateX(-7px)}75%{transform:translateX(7px)}}

/* ‚ïê‚ïê‚ïê FEEDBACK ‚ïê‚ïê‚ïê */
.fb-overlay{display:none;position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.4);align-items:center;justify-content:center;padding:16px;}
.fb-overlay.show{display:flex;}
.fb-card{background:white;border-radius:24px;padding:24px 20px;max-width:300px;width:100%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.3);animation:popIn .28s ease;}
@keyframes popIn{from{transform:scale(.6);opacity:0}to{transform:scale(1);opacity:1}}
.fb-icon{font-size:3.8rem;display:block;margin-bottom:6px;}
.fb-card h3{font-family:'Bubblegum Sans',cursive;font-size:1.5rem;margin-bottom:5px;}
.fb-card p{font-size:.9rem;font-weight:700;color:#6b7280;line-height:1.5;}
.fb-btn{margin-top:12px;background:linear-gradient(135deg,#f97316,#ec4899);color:white;border:none;border-radius:50px;padding:10px 28px;font-family:'Bubblegum Sans',cursive;font-size:.95rem;cursor:pointer;}

/* ‚ïê‚ïê‚ïê WIN ‚ïê‚ïê‚ïê */
.win-overlay{display:none;position:fixed;inset:0;z-index:400;background:rgba(255,248,230,.95);backdrop-filter:blur(10px);flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:24px;}
.win-overlay.show{display:flex;}
.win-trophy{font-size:5rem;animation:tBounce 1s ease infinite alternate;}
@keyframes tBounce{from{transform:rotate(-8deg)scale(1)}to{transform:rotate(8deg)scale(1.14)}}
.win-overlay h2{font-family:'Bubblegum Sans',cursive;font-size:clamp(1.9rem,7vw,2.9rem);color:#f97316;margin:10px 0 5px;}
.win-overlay p{font-size:1rem;color:#92400e;font-weight:700;margin:3px 0;}
.win-stats{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:10px 0;}
.win-stat{background:white;border-radius:50px;padding:6px 16px;font-weight:900;color:#c2410c;border:2px solid #fed7aa;}
.win-btn{margin-top:10px;background:linear-gradient(135deg,#f97316,#ec4899);color:white;border:none;border-radius:50px;padding:12px 32px;font-family:'Bubblegum Sans',cursive;font-size:1rem;cursor:pointer;box-shadow:0 6px 18px rgba(249,115,22,.45);}
.cf{position:absolute;font-size:1.5rem;animation:cfFall linear forwards;pointer-events:none;}
@keyframes cfFall{from{transform:translateY(-50px)rotate(0deg);opacity:1}to{transform:translateY(110vh)rotate(720deg);opacity:0}}
</style>
</head>
<body>

<!-- WIN -->
<div class="win-overlay" id="winOverlay">
  <div style="position:absolute;inset:0;pointer-events:none;overflow:hidden;" id="cfWrap"></div>
  <div class="win-trophy">üèÜ</div>
  <h2 id="winTitle">Math Star!</h2>
  <p id="winMsg"></p>
  <div class="win-stats">
    <div class="win-stat" id="winScore"></div>
    <div class="win-stat" id="winBest"></div>
  </div>
  <button class="win-btn" onclick="resetAll()">üéÆ Play Again!</button>
  <a href="index.html" style="margin-top:10px;display:inline-block;color:#f97316;font-weight:900;font-size:1rem;text-decoration:none;">üè† Home</a>
</div>

<!-- FEEDBACK -->
<div class="fb-overlay" id="fbOverlay">
  <div class="fb-card">
    <span class="fb-icon" id="fbIcon"></span>
    <h3 id="fbTitle"></h3>
    <p id="fbMsg"></p>
    <button class="fb-btn" onclick="closeFb()">Next ‚û°Ô∏è</button>
  </div>
</div>

<header>
  <a href="index.html" class="home-btn">üè† Home</a>
  <h1>üåâ Eshanvi's Math World</h1>
  <div class="hsp"></div>
</header>

<div class="score-bar">
  <div class="chip" id="scoreChip">‚≠ê <span id="scoreVal">0</span></div>
  <div class="chip" id="streakChip">üî• <span id="streakVal">0</span></div>
  <div class="chip">Q: <span id="qNum">1</span>/10</div>
</div>

<div class="mode-tabs">
  <div class="mode-tab active" id="tabA" onclick="switchMode('A')">
    <span class="ti">üåâ</span>Valley Bridge<br><small style="font-family:Nunito,sans-serif;font-size:.7rem;font-weight:700;">Type the answer!</small>
  </div>
  <div class="mode-tab" id="tabB" onclick="switchMode('B')">
    <span class="ti">üç≠</span>Candy Shop<br><small style="font-family:Nunito,sans-serif;font-size:.7rem;font-weight:700;">Choose wisely!</small>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODE A ‚Äî VALLEY BRIDGE
     Type the correct number to
     raise the raft. On correct:
     Eshanvi walks over and hugs!
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="modeA">
  <div class="scene-wrap">
    <svg id="sceneSVG" viewBox="0 0 420 220" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="skyG" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#93c5fd"/><stop offset="100%" stop-color="#bfdbfe"/></linearGradient>
        <linearGradient id="waterG" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#38bdf8"/><stop offset="100%" stop-color="#0284c7"/></linearGradient>
        <linearGradient id="cliffLG" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#4ade80"/><stop offset="100%" stop-color="#15803d"/></linearGradient>
        <linearGradient id="cliffRG" x1="1" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#4ade80"/><stop offset="100%" stop-color="#15803d"/></linearGradient>
      </defs>

      <!-- Sky -->
      <rect width="420" height="220" fill="url(#skyG)"/>

      <!-- Animated clouds -->
      <g opacity=".8"><ellipse cx="60" cy="28" rx="34" ry="14" fill="white"/><ellipse cx="78" cy="23" rx="22" ry="13" fill="white"/><ellipse cx="44" cy="26" rx="18" ry="11" fill="white"/>
        <animateTransform attributeName="transform" type="translate" values="0 0;15 0;0 0" dur="16s" repeatCount="indefinite"/>
      </g>
      <g opacity=".6"><ellipse cx="300" cy="20" rx="26" ry="11" fill="white"/><ellipse cx="316" cy="16" rx="18" ry="10" fill="white"/><ellipse cx="284" cy="18" rx="14" ry="8" fill="white"/>
        <animateTransform attributeName="transform" type="translate" values="0 0;-12 0;0 0" dur="20s" repeatCount="indefinite"/>
      </g>

      <!-- Sun with face + speech bubble -->
      <g id="sunG" transform="translate(378,38)">
        <circle r="22" fill="#fbbf24"><animate attributeName="r" values="22;24;22" dur="3s" repeatCount="indefinite"/></circle>
        <circle cx="-6" cy="-4" r="3" fill="#92400e"/><circle cx="6" cy="-4" r="3" fill="#92400e"/>
        <path d="M-7 5 Q0 13 7 5" stroke="#92400e" stroke-width="2" fill="none" stroke-linecap="round"/>
        <line x1="0" y1="-26" x2="0" y2="-33" stroke="#fde68a" stroke-width="3" stroke-linecap="round"/>
        <line x1="18" y1="-18" x2="22" y2="-22" stroke="#fde68a" stroke-width="3" stroke-linecap="round"/>
        <line x1="26" y1="0" x2="32" y2="0" stroke="#fde68a" stroke-width="3" stroke-linecap="round"/>
        <line x1="-18" y1="-18" x2="-22" y2="-22" stroke="#fde68a" stroke-width="3" stroke-linecap="round"/>
        <line x1="-26" y1="0" x2="-32" y2="0" stroke="#fde68a" stroke-width="3" stroke-linecap="round"/>
      </g>
      <!-- Sun speech bubble -->
      <rect x="180" y="8" width="178" height="36" rx="10" fill="white" stroke="#fbbf24" stroke-width="2"/>
      <polygon points="356,36 372,44 360,44" fill="white" stroke="#fbbf24" stroke-width="1"/>
      <text id="sunLine1" x="269" y="22" text-anchor="middle" font-family="Bubblegum Sans,cursive" font-size="10" fill="#92400e">Solve this to raise</text>
      <text id="sunLine2" x="269" y="37" text-anchor="middle" font-family="Bubblegum Sans,cursive" font-size="12" fill="#f97316" font-weight="bold">the bridge! üåâ</text>

      <!-- Left cliff -->
      <polygon points="0,220 0,92 108,92 84,220" fill="url(#cliffLG)"/>
      <ellipse cx="50" cy="91" rx="58" ry="10" fill="#4ade80"/>
      <path d="M4 92 Q28 80 52 92 Q68 100 84 92" fill="none" stroke="#86efac" stroke-width="2"/>

      <!-- Right cliff -->
      <polygon points="318,92 420,92 420,220 340,220" fill="url(#cliffRG)"/>
      <ellipse cx="370" cy="91" rx="56" ry="10" fill="#4ade80"/>
      <path d="M340 92 Q360 80 382 92 Q400 100 420 92" fill="none" stroke="#86efac" stroke-width="2"/>

      <!-- River -->
      <rect x="84" y="150" width="234" height="70" fill="url(#waterG)"/>
      <path d="M84 165 Q130 154 178 165 Q226 176 278 165 Q305 158 340 165" stroke="#7dd3fc" stroke-width="2.5" fill="none" opacity=".7"/>
      <text x="140" y="183" font-size="14" opacity=".55">üêü</text>
      <text x="240" y="195" font-size="13" opacity=".45">üê†</text>

      <!-- Pulley system -->
      <!-- Left pole -->
      <rect x="84" y="52" width="7" height="42" rx="3" fill="#78350f"/>
      <circle cx="87.5" cy="51" r="9" fill="#a16207" stroke="#78350f" stroke-width="2"/>
      <!-- Right pole -->
      <rect x="329" y="52" width="7" height="42" rx="3" fill="#78350f"/>
      <circle cx="332.5" cy="51" r="9" fill="#a16207" stroke="#78350f" stroke-width="2"/>
      <!-- Ropes (will update endpoints dynamically) -->
      <line id="ropeL" x1="87.5" y1="51" x2="200" y2="102" stroke="#a16207" stroke-width="2.5" stroke-dasharray="5,3"/>
      <line id="ropeR" x1="332.5" y1="51" x2="200" y2="102" stroke="#a16207" stroke-width="2.5" stroke-dasharray="5,3"/>
      <line id="ropeV" x1="200" y1="51" x2="200" y2="102" stroke="#a16207" stroke-width="2.5"/>

      <!-- Target / bridge level -->
      <line x1="84" y1="150" x2="340" y2="150" stroke="#22c55e" stroke-width="2" stroke-dasharray="8,5" opacity=".55"/>
      <text x="200" y="146" text-anchor="middle" font-family="Nunito,sans-serif" font-size="8" fill="#166534" font-weight="900" opacity=".65">üéØ Safe crossing level</text>

      <!-- RAFT (moves vertically) ‚Äî default raftY = 102, crossing raftY = 132 (raft top = 150-18) -->
      <g id="raftGroup">
        <rect id="raftPlatform" x="156" y="102" width="88" height="17" rx="5" fill="#d97706" stroke="#92400e" stroke-width="2"/>
        <line x1="172" y1="102" x2="172" y2="119" stroke="#92400e" stroke-width="1.5"/>
        <line x1="190" y1="102" x2="190" y2="119" stroke="#92400e" stroke-width="1.5"/>
        <line x1="208" y1="102" x2="208" y2="119" stroke="#92400e" stroke-width="1.5"/>
        <line x1="228" y1="102" x2="228" y2="119" stroke="#92400e" stroke-width="1.5"/>
        <text id="raftWt" x="200" y="117" text-anchor="middle" font-family="Bubblegum Sans,cursive" font-size="9" fill="white">0 kg</text>
        <!-- Eshanvi on raft -->
        <text id="eshanviRaft" x="200" y="100" text-anchor="middle" font-size="20">üëß</text>
      </g>

      <!-- Parents on left cliff (always visible) -->
      <text x="18" y="86" font-size="20">üòä</text>
      <text x="42" y="86" font-size="20">üòç</text>
      <text x="32" y="76" text-anchor="middle" font-family="Nunito,sans-serif" font-size="7" fill="#166534" font-weight="900">Amma &amp; Appa</text>

      <!-- Eshanvi walking across bridge (hidden until correct) -->
      <text id="eshanviWalk" x="-40" y="88" text-anchor="middle" font-size="22" opacity="0">üëß</text>

      <!-- Hug scene (hidden until win) -->
      <g id="hugScene" opacity="0">
        <text x="16" y="86" font-size="20">ü§ó</text>
        <text x="38" y="86" font-size="22">üëß</text>
        <text x="60" y="86" font-size="20">ü§ó</text>
        <text x="38" y="73" text-anchor="middle" font-family="Bubblegum Sans,cursive" font-size="9" fill="#ec4899">YAY! We love you!</text>
      </g>

      <!-- Status arrow -->
      <text id="statusArrow" x="200" y="84" text-anchor="middle" font-size="16" opacity="0">‚¨áÔ∏è</text>

      <!-- Weight bucket left of raft -->
      <g id="bucketG">
        <rect x="58" y="104" width="28" height="20" rx="3" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
        <path d="M62 104 L59 96 L83 96 L80 104" stroke="#f59e0b" stroke-width="1.8" fill="none"/>
        <text id="bucketTxt" x="72" y="118" text-anchor="middle" font-family="Bubblegum Sans,cursive" font-size="7.5" fill="#92400e">0 kg</text>
      </g>
    </svg>
  </div>

  <div class="q-card">
    <div class="q-label">‚òÄÔ∏è The sun says ‚Äî type the answer to raise the raft!</div>
    <div class="q-equation" id="bridgeQ">Loading‚Ä¶</div>
    <div class="q-hint" id="bridgeHint"></div>
  </div>

  <div class="numpad-wrap">
    <div class="answer-display" id="ansDisp">_</div>
    <div class="numpad">
      <div class="nkey" onclick="np('7')">7</div><div class="nkey" onclick="np('8')">8</div><div class="nkey" onclick="np('9')">9</div><div class="nkey del" onclick="ndel()">‚å´</div>
      <div class="nkey" onclick="np('4')">4</div><div class="nkey" onclick="np('5')">5</div><div class="nkey" onclick="np('6')">6</div><div class="nkey del" onclick="nclr()">C</div>
      <div class="nkey" onclick="np('1')">1</div><div class="nkey" onclick="np('2')">2</div><div class="nkey" onclick="np('3')">3</div><div class="nkey" onclick="np('0')">0</div>
      <div class="nkey ok" onclick="nsubmit()">‚úÖ Check Answer!</div>
    </div>
    <div class="bridge-lives" id="bLives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODE B ‚Äî CANDY SHOP
     4 choices, strategically wrong
     options to teach common mistakes.
     Operations: +, -, √ó
     Combo streak dots!
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="modeB">
  <div class="shop-wrap">
    <svg id="shopSVG" viewBox="0 0 420 150" xmlns="http://www.w3.org/2000/svg">
      <rect width="420" height="150" fill="#fffbeb"/>
      <rect x="15" y="18" width="390" height="98" rx="14" fill="white" stroke="#fde68a" stroke-width="3"/>
      <rect x="25" y="52" width="370" height="5" rx="2" fill="#fde68a"/>
      <rect x="25" y="90" width="370" height="5" rx="2" fill="#fde68a"/>
      <rect x="145" y="6" width="130" height="20" rx="8" fill="#f97316"/>
      <text x="210" y="20" text-anchor="middle" font-family="Bubblegum Sans,cursive" font-size="12" fill="white">üè™ Sweet Shop</text>
      <g id="shelfItems"></g>
      <rect x="0" y="126" width="420" height="24" fill="#fed7aa"/>
      <text x="395" y="145" font-size="22">üßë‚Äçüç≥</text>
      <text x="12" y="145" font-size="20">üëß</text>
    </svg>
  </div>

  <div class="op-selector">
    <div class="op-btn active" id="opAdd" onclick="setOp('add',this)">‚ûï Add</div>
    <div class="op-btn" id="opSub" onclick="setOp('sub',this)">‚ûñ Subtract</div>
    <div class="op-btn" id="opMul" onclick="setOp('mul',this)">‚úñÔ∏è Times</div>
  </div>

  <div class="combo-row" id="comboRow"></div>

  <div class="problem-card">
    <div class="prob-visual" id="probVis"></div>
    <div class="choices" id="choiceGrid"></div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ SHARED ‚îÄ‚îÄ‚îÄ
let score=0,streak=0,bestStreak=0,round=1,maxRounds=10,currentMode='A';
function upScoreUI(){document.getElementById('scoreVal').textContent=score;document.getElementById('streakVal').textContent=streak;document.getElementById('qNum').textContent=Math.min(round,maxRounds);}
function popChip(id){const e=document.getElementById(id);e.classList.remove('pop');void e.offsetWidth;e.classList.add('pop');}

function switchMode(m){
  currentMode=m;
  document.getElementById('modeA').style.display=m==='A'?'block':'none';
  document.getElementById('modeB').style.display=m==='B'?'block':'none';
  document.getElementById('tabA').classList.toggle('active',m==='A');
  document.getElementById('tabB').classList.toggle('active',m==='B');
  if(m==='A')initBridge();else initShop();
}

function resetAll(){
  score=0;streak=0;bestStreak=0;round=1;
  document.getElementById('winOverlay').classList.remove('show');
  upScoreUI();
  if(currentMode==='A')initBridge();else initShop();
}

function showConfetti(){
  const w=document.getElementById('cfWrap');w.innerHTML='';
  'üéâüåü‚ú®üç≠üéäüíñ‚≠êüåàüéÄüèÖ'.split('').forEach(e=>{
    const el=document.createElement('div');el.className='cf';el.textContent=e;
    el.style.left=Math.random()*100+'%';el.style.animationDuration=(2+Math.random()*3)+'s';el.style.animationDelay=(Math.random()*2)+'s';
    w.appendChild(el);
  });
}
function showWin(){
  document.getElementById('winTitle').textContent=score>=130?'üåü Math Genius!':score>=80?'üéâ Amazing Work!':'üí™ Great Job!';
  document.getElementById('winMsg').textContent='You finished all '+maxRounds+' questions!';
  document.getElementById('winScore').textContent='‚≠ê Score: '+score;
  document.getElementById('winBest').textContent='üî• Best Streak: '+bestStreak;
  showConfetti();
  document.getElementById('winOverlay').classList.add('show');
}

let _fbCb=null;
function showFb(icon,title,msg,cb){
  document.getElementById('fbIcon').textContent=icon;
  document.getElementById('fbTitle').textContent=title;
  document.getElementById('fbMsg').textContent=msg;
  document.getElementById('fbOverlay').classList.add('show');
  _fbCb=cb||null;
}
function closeFb(){
  document.getElementById('fbOverlay').classList.remove('show');
  if(_fbCb){_fbCb();_fbCb=null;}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MODE A ‚Äî VALLEY BRIDGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let bAns='',bTarget=0,bLives=3,RAFT_DEFAULT=102,RAFT_CROSS=132;

function initBridge(){
  bAns='';bLives=3;
  updateAnsDisp();renderLives();
  setRaft(RAFT_DEFAULT,false);
  resetChars();
  nextBridgeQ();
}

function nextBridgeQ(){
  bAns='';updateAnsDisp();
  setRaft(RAFT_DEFAULT,true);
  document.getElementById('bucketTxt').textContent='0 kg';
  document.getElementById('raftWt').textContent='0 kg';
  document.getElementById('statusArrow').setAttribute('opacity','0');
  resetChars();

  const ops=['add','sub','mul'];
  const op=ops[Math.floor(Math.random()*ops.length)];
  let a,b,eq,hint;
  if(op==='add'){
    a=Math.floor(Math.random()*18)+2;b=Math.floor(Math.random()*18)+2;
    bTarget=a+b;eq=a+' + '+b+' = ?';hint='Add '+a+' and '+b;
  } else if(op==='sub'){
    a=Math.floor(Math.random()*18)+8;b=Math.floor(Math.random()*(a-2))+1;
    bTarget=a-b;eq=a+' ‚àí '+b+' = ?';hint='Subtract '+b+' from '+a;
  } else {
    const tbls=[2,3,4,5,10];
    a=tbls[Math.floor(Math.random()*tbls.length)];
    b=Math.floor(Math.random()*10)+1;
    bTarget=a*b;eq=a+' √ó '+b+' = ?';hint=a+' times '+b;
  }
  document.getElementById('bridgeQ').textContent=eq;
  document.getElementById('bridgeHint').textContent=hint;
  document.getElementById('sunLine1').textContent='Solve this to raise';
  document.getElementById('sunLine2').textContent='the bridge! üåâ';
}

function np(d){
  if(bAns.length>=3)return;
  bAns+=d;updateAnsDisp();
  const partial=parseInt(bAns)||0;
  const ratio=Math.min(partial/bTarget,1.3);
  const raftY=RAFT_DEFAULT+(RAFT_CROSS-RAFT_DEFAULT)*ratio;
  setRaft(Math.min(raftY,RAFT_CROSS+8),true);
  document.getElementById('bucketTxt').textContent=partial+' kg';
  document.getElementById('raftWt').textContent=partial+' kg';
}
function ndel(){bAns=bAns.slice(0,-1);updateAnsDisp();const p=parseInt(bAns)||0;const r=Math.min(p/bTarget,1.3);setRaft(RAFT_DEFAULT+(RAFT_CROSS-RAFT_DEFAULT)*r,true);document.getElementById('bucketTxt').textContent=p+' kg';document.getElementById('raftWt').textContent=p+' kg';}
function nclr(){bAns='';updateAnsDisp();setRaft(RAFT_DEFAULT,true);document.getElementById('bucketTxt').textContent='0 kg';document.getElementById('raftWt').textContent='0 kg';}
function updateAnsDisp(){document.getElementById('ansDisp').textContent=bAns===''?'_':bAns;}

function nsubmit(){
  if(bAns==='')return;
  const val=parseInt(bAns);
  if(val===bTarget){
    setRaft(RAFT_CROSS,true);
    score+=15+streak*3;streak++;if(streak>bestStreak)bestStreak=streak;
    popChip('scoreChip');popChip('streakChip');upScoreUI();
    document.getElementById('sunLine1').textContent='üéâ Correct!';
    document.getElementById('sunLine2').textContent=val+' is exactly right!';
    // animate crossing then hug
    setTimeout(()=>{
      animateCrossing(()=>{
        round++;
        if(round>maxRounds){setTimeout(showWin,600);}
        else showFb('üåâ','Bridge Built!',val+' is correct! Eshanvi crossed the bridge! +' +(15+(streak-1)*3)+' pts ‚≠ê',()=>nextBridgeQ());
      });
    },600);
  } else {
    bLives--;renderLives();streak=0;upScoreUI();
    if(val>bTarget){
      setRaft(RAFT_CROSS-10,true);
      document.getElementById('statusArrow').textContent='‚¨ÜÔ∏è';
      document.getElementById('statusArrow').setAttribute('opacity','1');
      showFb('‚¨ÜÔ∏è','Too high!',val+' is too big ‚Äî the raft went too far up! The answer was '+bTarget+'.',()=>{
        document.getElementById('statusArrow').setAttribute('opacity','0');
        if(bLives<=0){bLives=3;renderLives();}
        bAns='';updateAnsDisp();setRaft(RAFT_DEFAULT,true);
        document.getElementById('bucketTxt').textContent='0 kg';document.getElementById('raftWt').textContent='0 kg';
      });
    } else {
      setRaft(RAFT_DEFAULT+10,true);
      document.getElementById('statusArrow').textContent='‚¨áÔ∏è';
      document.getElementById('statusArrow').setAttribute('opacity','1');
      showFb('‚¨áÔ∏è','Too low!',val+' is not enough ‚Äî the raft stayed in the water! The answer was '+bTarget+'.',()=>{
        document.getElementById('statusArrow').setAttribute('opacity','0');
        if(bLives<=0){bLives=3;renderLives();}
        bAns='';updateAnsDisp();setRaft(RAFT_DEFAULT,true);
        document.getElementById('bucketTxt').textContent='0 kg';document.getElementById('raftWt').textContent='0 kg';
      });
    }
  }
}

function renderLives(){document.getElementById('bLives').innerHTML='‚ù§Ô∏è'.repeat(bLives)+'ü§ç'.repeat(Math.max(0,3-bLives));}

// Raft movement ‚Äî moves all child elements by translating the group
let currentRaftY=102;
function setRaft(targetY,animated){
  currentRaftY=targetY;
  const dy=targetY-RAFT_DEFAULT; // how many px up from default (positive = down, we want up so negate)
  const group=document.getElementById('raftGroup');
  const bucket=document.getElementById('bucketG');
  if(animated){
    group.style.transition='transform .65s cubic-bezier(.34,1.56,.64,1)';
    bucket.style.transition='transform .65s cubic-bezier(.34,1.56,.64,1)';
  } else {
    group.style.transition='none';bucket.style.transition='none';
  }
  group.setAttribute('transform','translate(0,'+dy+')');
  // bucket goes down as raft goes up (pulley effect)
  bucket.setAttribute('transform','translate(0,'+(-dy*0.5)+')');
  // update rope endpoint
  const ropey=102+dy;
  document.getElementById('ropeL').setAttribute('y2',ropey);
  document.getElementById('ropeR').setAttribute('y2',ropey);
  document.getElementById('ropeV').setAttribute('y2',ropey);
}

function resetChars(){
  document.getElementById('eshanviRaft').setAttribute('opacity','1');
  document.getElementById('eshanviWalk').setAttribute('opacity','0');
  document.getElementById('hugScene').setAttribute('opacity','0');
}

function animateCrossing(cb){
  // hide raft Eshanvi, show walker, animate from right (raft x‚âà200) to left cliff (x‚âà52)
  document.getElementById('eshanviRaft').setAttribute('opacity','0');
  const walker=document.getElementById('eshanviWalk');
  walker.setAttribute('opacity','1');
  walker.setAttribute('x','200');
  walker.setAttribute('y','88');
  let x=200;
  const iv=setInterval(()=>{
    x-=4;walker.setAttribute('x',String(x));
    if(x<=52){
      clearInterval(iv);
      walker.setAttribute('opacity','0');
      // show hug
      document.getElementById('hugScene').setAttribute('opacity','1');
      // little hearts burst
      setTimeout(()=>cb(),900);
    }
  },30);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MODE B ‚Äî CANDY SHOP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CANDIES=[
  {e:'üç¨',n:'Lollipop',p:3},{e:'üç´',n:'Chocolate',p:5},{e:'üç≠',n:'Candy',p:2},
  {e:'üßÅ',n:'Cupcake',p:8},{e:'üç©',n:'Donut',p:6},{e:'üç™',n:'Cookie',p:4},
  {e:'üç¶',n:'Ice Cream',p:7},{e:'üç°',n:'Mochi',p:9},{e:'üéÇ',n:'Cake',p:10},
  {e:'üçÆ',n:'Pudding',p:5}
];
let shopOp='add',shopCombo=0;
const COMBO_MAX=5;

function setOp(op,btn){
  shopOp=op;shopCombo=0;
  document.querySelectorAll('.op-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderComboDots();nextShopQ();
}

function initShop(){
  shopOp='add';shopCombo=0;
  document.querySelectorAll('.op-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('opAdd').classList.add('active');
  fillShelf();renderComboDots();nextShopQ();
}

function fillShelf(){
  const g=document.getElementById('shelfItems');g.innerHTML='';
  const xs=[40,80,120,160,200,240,280,320,360,400];
  CANDIES.forEach((c,i)=>{
    const t=document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x',xs[i]);t.setAttribute('y',48);t.setAttribute('font-size','18');t.setAttribute('text-anchor','middle');t.textContent=c.e;g.appendChild(t);
    const p=document.createElementNS('http://www.w3.org/2000/svg','text');
    p.setAttribute('x',xs[i]);p.setAttribute('y',84);p.setAttribute('font-size','7.5');p.setAttribute('text-anchor','middle');
    p.setAttribute('font-family','Bubblegum Sans,cursive');p.setAttribute('fill','#f97316');p.textContent='‚Çπ'+c.p;g.appendChild(p);
  });
}

function renderComboDots(){
  const row=document.getElementById('comboRow');row.innerHTML='';
  for(let i=0;i<COMBO_MAX;i++){
    const d=document.createElement('div');d.className='c-dot'+(i<shopCombo?' lit':'');row.appendChild(d);
  }
  if(shopCombo>=COMBO_MAX){
    const lbl=document.createElement('span');
    lbl.style.cssText='font-family:Bubblegum Sans,cursive;font-size:.88rem;color:#f97316;font-weight:900;margin-left:6px;';
    lbl.textContent='üî• Combo x'+shopCombo+'!';row.appendChild(lbl);
  }
}

function nextShopQ(){
  const vis=document.getElementById('probVis');
  const grid=document.getElementById('choiceGrid');
  vis.innerHTML='';grid.innerHTML='';

  // Pick candies
  let c1=CANDIES[Math.floor(Math.random()*CANDIES.length)];
  let c2=CANDIES[Math.floor(Math.random()*CANDIES.length)];
  while(c2===c1)c2=CANDIES[Math.floor(Math.random()*CANDIES.length)];

  let correctAns,label;

  if(shopOp==='add'){
    // Buy two types: qty1 of c1 and qty2 of c2, how much total?
    const q1=Math.floor(Math.random()*3)+1;
    const q2=Math.floor(Math.random()*3)+1;
    const a=c1.p*q1, b=c2.p*q2;
    correctAns=a+b;
    label='‚Çπ'+a+' + ‚Çπ'+b;
    vis.innerHTML=
      '<div class="cg"><div class="ce">'+c1.e.repeat(q1)+'</div><div class="cp">'+q1+' √ó ‚Çπ'+c1.p+' = ‚Çπ'+a+'</div></div>'+
      '<div class="op-sym">+</div>'+
      '<div class="cg"><div class="ce">'+c2.e.repeat(q2)+'</div><div class="cp">'+q2+' √ó ‚Çπ'+c2.p+' = ‚Çπ'+b+'</div></div>'+
      '<div class="eq-sym">=</div>'+
      '<div class="cg"><div class="ce">üí∞</div><div class="cp" style="color:#7c3aed">‚Çπ ?</div></div>';
  } else if(shopOp==='sub'){
    // Has budget, buys something, how much change?
    const budget=Math.floor(Math.random()*25)+15;
    const qty=Math.floor(Math.random()*3)+1;
    const spent=c1.p*qty;
    if(spent>=budget){correctAns=c1.p;label='‚Çπ'+budget+' ‚àí ‚Çπ'+c1.p;}
    else{correctAns=budget-spent;label='‚Çπ'+budget+' ‚àí ‚Çπ'+spent;}
    const displaySpent=(spent>=budget)?c1.p:spent;
    vis.innerHTML=
      '<div class="cg"><div class="ce">üëõ</div><div class="cp">Has ‚Çπ'+budget+'</div></div>'+
      '<div class="op-sym">‚àí</div>'+
      '<div class="cg"><div class="ce">'+c1.e+'</div><div class="cp">Costs ‚Çπ'+displaySpent+'</div></div>'+
      '<div class="eq-sym">=</div>'+
      '<div class="cg"><div class="ce">ü§ë</div><div class="cp" style="color:#7c3aed">Change?</div></div>';
  } else {
    // Times tables ‚Äî N of this candy, total cost?
    const qty=Math.floor(Math.random()*10)+2;
    correctAns=c1.p*qty;
    label=qty+' √ó ‚Çπ'+c1.p;
    const showEmoji=Math.min(qty,6);
    vis.innerHTML=
      '<div class="cg"><div class="ce">'+c1.e.repeat(showEmoji)+(qty>6?'‚Ä¶':'')+'</div><div class="cp">'+qty+' √ó ‚Çπ'+c1.p+'</div></div>'+
      '<div class="eq-sym">=</div>'+
      '<div class="cg"><div class="ce">üíµ</div><div class="cp" style="color:#7c3aed">Total?</div></div>';
  }

  // Build 4 choices ‚Äî clever wrong answers that reflect common mistakes
  const choices=buildChoices(correctAns,shopOp);
  choices.forEach(val=>{
    const btn=document.createElement('div');
    btn.className='choice';
    btn.textContent='‚Çπ'+val;
    btn.onclick=()=>checkShop(val,correctAns,btn,label,choices);
    grid.appendChild(btn);
  });
}

function buildChoices(correct,op){
  // Wrong answers crafted to catch typical errors
  const wrongs=new Set();
  if(op==='add'){
    wrongs.add(correct-1);wrongs.add(correct+1);wrongs.add(correct+10);
    wrongs.add(Math.max(1,correct-10));
  } else if(op==='sub'){
    wrongs.add(correct+1);wrongs.add(correct-1);
    wrongs.add(correct+5);wrongs.add(Math.max(1,correct-5));
  } else {
    // times tables: add instead of multiply, off by one table
    wrongs.add(correct+Math.floor(correct/3));
    wrongs.add(Math.max(1,correct-Math.floor(correct/3)));
    wrongs.add(correct+1);wrongs.add(Math.max(1,correct-1));
  }
  let filtered=[...wrongs].filter(v=>v>0&&v!==correct&&Number.isInteger(v));
  // deduplicate
  filtered=[...new Set(filtered)];
  // trim to 3
  while(filtered.length<3){let r=correct+Math.floor(Math.random()*6)+1;if(r!==correct&&!filtered.includes(r))filtered.push(r);}
  filtered=filtered.slice(0,3);
  const all=[correct,...filtered];
  for(let i=all.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[all[i],all[j]]=[all[j],all[i]];}
  return all;
}

function checkShop(val,correct,btn,label,allVals){
  // lock all
  document.querySelectorAll('.choice').forEach(b=>b.style.pointerEvents='none');

  if(val===correct){
    btn.classList.add('correct');
    const pts=10+streak*2+(shopCombo>=COMBO_MAX?5:0);
    score+=pts;streak++;if(streak>bestStreak)bestStreak=streak;
    shopCombo=Math.min(shopCombo+1,COMBO_MAX+1);
    popChip('scoreChip');popChip('streakChip');renderComboDots();upScoreUI();
    const comboStr=shopCombo>=3?' üî• '+shopCombo+' in a row!':'';
    setTimeout(()=>{
      round++;
      if(round>maxRounds)showWin();
      else showFb('üéâ','Correct!',label+' = ‚Çπ'+correct+'! Well done!'+comboStr+' +'+pts+' pts',()=>nextShopQ());
    },550);
  } else {
    btn.classList.add('wrong');
    // reveal correct
    document.querySelectorAll('.choice').forEach(b=>{
      if(parseInt(b.textContent.replace('‚Çπ',''))===correct)b.classList.add('reveal');
    });
    streak=0;shopCombo=0;renderComboDots();upScoreUI();
    // Explain WHY the correct answer is right
    const explain=explainMistake(val,correct,label);
    setTimeout(()=>{
      round++;
      if(round>maxRounds)showWin();
      else showFb('ü§î','Not quite!',explain,()=>nextShopQ());
    },900);
  }
}

function explainMistake(wrong,correct,label){
  const diff=wrong-correct;
  if(Math.abs(diff)===1)return label+' = ‚Çπ'+correct+'. You were just ‚Çπ1 away ‚Äî so close! üåü';
  if(diff>0)return label+' = ‚Çπ'+correct+'. ‚Çπ'+wrong+' is too much! Try counting more carefully. üí™';
  return label+' = ‚Çπ'+correct+'. ‚Çπ'+wrong+' is too little! Don\'t forget to count everything. üìù';
}

// ‚îÄ‚îÄ‚îÄ START ‚îÄ‚îÄ‚îÄ
window.addEventListener('load',()=>switchMode('A'));
</script>
</body>
</html>
